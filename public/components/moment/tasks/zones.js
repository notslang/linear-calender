var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function t(){s(d,function(){e.log.writeln("Resetting timezone back to "+d),o()})}function a(t){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,a){t(a.stdout.replace("Time Zone: ",""))})}function n(t){e.utils.spawn({cmd:"systemsetup",args:["listtimezones"]},function(e,a){var n=a.stdout.replace("Time Zones:","");n=n.match(/\S+/g),t(n)})}function s(t,a){e.utils.spawn({cmd:"systemsetup",args:["settimezone",t]},function(){a()})}function _(e){var t=i.pop();t?s(t,function(){r(t,function(){_(e)})}):e()}function r(a,n){e.utils.spawn({cmd:"grunt",args:["zone"]},function(e,a){if(e)throw t(),e;console.log(a.stdout),n()})}var i,d,o;e.registerTask("zones","Run the unit tests in different timezones.",function(){o=this.async(),a(function(e){d=e,n(function(e){i=e,_(function(){t()})})})})};