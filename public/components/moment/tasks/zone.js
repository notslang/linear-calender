var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function a(a){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,t){a(t.stdout.replace("Time Zone: ",""))})}function t(e,a){nodeunit.runFiles([path.join(process.cwd(),"test/moment"),path.join(process.cwd(),"test/lang")],{testDone:function(a,t){t.failures()&&r.push([e,a,t])},done:function(t){_(e,t),a()}})}function n(a,t,n){e.log.writeln(""),e.log.error(a+" failed: "+t),n.forEach(function(a){var t=a.error;a.failed()&&(a.message&&e.log.error(a.message),t&&t.actual&&t.expected&&t.operator&&e.log.error([t.actual,t.operator,t.expected].join(" ")))})}function _(a,t){var n=t.failures(),_=t.length-n,s=n?"XX".red:"OK".green,r=_+" passed",u=n?(n+" failed").red:n+" failed",m=""+-moment().zone()/60;e.log.writetableln(d,[s,m,a,r,u]),n?i++:o++}function s(){var a;if(i)for(e.log.writeln(i+" failures"),a=0;r.length>a;a++)n.apply(null,r[a])}var r=[],d=[4,6,46,12,12],i=0,o=0;e.registerTask("zone","Run the unit tests in the current timezone.",function(){var e=this.async();a(function(a){t(a,function(){s(),e()})})})};