var path=require("path"),nodeunit=require("nodeunit"),moment=require("../moment");module.exports=function(e){function t(t){e.utils.spawn({cmd:"systemsetup",args:["gettimezone"]},function(e,a){t(a.stdout.replace("Time Zone: ",""))})}function a(e,t){nodeunit.runFiles([path.join(process.cwd(),"test/moment"),path.join(process.cwd(),"test/lang")],{testDone:function(t,a){a.failures()&&r.push([e,t,a])},done:function(a){_(e,a),t()}})}function n(t,a,n){e.log.writeln(""),e.log.error(t+" failed: "+a),n.forEach(function(t){var a=t.error;t.failed()&&(t.message&&e.log.error(t.message),a&&a.actual&&a.expected&&a.operator&&e.log.error([a.actual,a.operator,a.expected].join(" ")))})}function _(t,a){var n=a.failures(),_=a.length-n,s=n?"XX".red:"OK".green,r=_+" passed",u=n?(n+" failed").red:n+" failed",l=""+-moment().zone()/60;e.log.writetableln(i,[s,l,t,r,u]),n?d++:o++}function s(){var t;if(d)for(e.log.writeln(d+" failures"),t=0;r.length>t;t++)n.apply(null,r[t])}var r=[],i=[4,6,46,12,12],d=0,o=0;e.registerTask("zone","Run the unit tests in the current timezone.",function(){var e=this.async();t(function(t){a(t,function(){s(),e()})})})};